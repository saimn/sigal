<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>{{ title }}</title>
    <meta name="description" content="">
    <meta name="author" content="{{ author }}">
    <meta name="viewport" content="width=device-width">

    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans">
    <link rel="stylesheet" href="{{ theme.url }}/css/style.min.css">
    <!--[if lt IE 9]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">

      <div class="four columns">
        <div class="sidebar">
          <h1><a href="{{ index_url }}">{{ index_title }}</a></h1>

          {% if settings.links %}
          <nav id="menu">
            <ul>
              {% for title, link in settings.links %}
              <li><a href="{{ link }}">{{ title }}</a></li>
              {% endfor %}
            </ul>
          </nav>
          {% endif %}

          <footer>
            <p>{% if author %}&copy; {{ author }} - {% endif %}
              Generated by <a href="{{ sigal_link }}">sigal</a></p>
          </footer>
        </div>
      </div>

      <div id="main" role="main" class="twelve columns offset-by-four">
        <header>
          {% if breadcrumb %}
          <h2>
            {%- for url, title in breadcrumb -%}
            <a href="{{ url }}">{{ title }}</a>
            {%- if not loop.last %} Â» {% endif -%}
            {% endfor -%}
          </h2>
          <hr>
          {% endif %}
        </header>

        {% if albums %}
        {% for album in albums %}
          {% if loop.index % 3 == 1 %}
          <div id="albums" class="row">
          {% endif%}

          <div class="four columns thumbnail
                      {% if loop.index % 3 == 1 %}alpha{% endif%}
                      {% if loop.index % 3 == 0 %}omega{% endif%}">
            <a href="{{ album.url }}">
              <img src="{{ album.thumb }}" class="album_thumb"
                   alt="{{ album.name }}" title="{{ album.name }}" /></a>
            <span class="album_title">{{ album.title }}</span>
          </div>

          {% if loop.last or loop.index % 3 == 0 %}
          </div>
          {% endif%}
        {% endfor %}
        {% endif %}

        {% if medias %}
          {% macro img_description(media) -%}
            {% if media.big %} data-big="{{ media.big }}"{% endif %}
            {% if media.exif %}
              {% if media.exif.datetime %}
                data-date=", {{ media.exif.datetime.strftime('%d %B %Y') }}"
              {% endif %}
            {% endif %}
          {%- endmacro %}
        <div id="gallery" class="row">
          {% for media in medias %}
            {% if media.type == "img" %}
            <div class="four columns thumbnail
                        {% if loop.index % 3 == 1 %}alpha{% endif%}
                        {% if loop.index % 3 == 0 %}omega{% endif%}">
              <a href="{{ media.file }}" class="gallery" title="{{ media.file }}" {{ img_description(media) }}>
                <img src="{{ media.thumb }}" alt="{{ media.file }}"
                    title="{{ media.file }}" /></a>
            </div>
            {% endif %}
            {% if media.type == "vid" %}
              <div class="four columns thumbnail
                          {% if loop.index % 3 == 1 %}alpha{% endif%}
                          {% if loop.index % 3 == 0 %}omega{% endif%}">
                <a href="#{{ media.file|replace('.', '') }}" class="gallery"
                  inline='yes' title="{{ media.file }}"
                  {% if media.big %} data-big="{{ media.big }}"{% endif %}>
                  <img src="{{ media.thumb }}" alt="{{ media.file }}"
                      title="{{ media.file }}" /></a>
              </div>
              <!-- This contains the hidden content for the video -->
              <div style='display:none'>
                <div id="{{ media.file|replace('.', '') }}">
                  <video controls>
                  <source src='{{ media.file }}' type='video/webm' />
                  </video>
                </div>
              </div>
            {% endif %}
          {% endfor %}
        </div>
        {% endif %}

        {% if zip_gallery %}
        <div id="additionnal-infos" class="row">
          <p>
            <a href="{{ zip_gallery }}"
               title="Download a zip archive with all images">Download ZIP</a>
          </p>
        </div>
        {% endif %}

        {% if description %}
        <div id="description" class="row">
          {{ description }}
        </div>
        {% endif %}
      </div>
    </div>

    {% if medias %}
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script>!window.jQuery && document.write(unescape('%3Cscript src="{{ theme.url }}/js/jquery-1.10.2.min.js"%3E%3C/script%3E'))</script>
    <script src="{{ theme.url }}/js/jquery.colorbox.min.js"></script>

    <script>
      $(".gallery").colorbox({
        rel:"gallery",
        transition:"none",
        maxWidth: "90%",
        maxHeight: "90%",
        scalePhotos: true,
        current: "{current} / {total}",
        title: function () {
          title = this.title;
          if(this.hasAttribute("data-big")) {
            title += " (full size)".link(this.getAttribute("data-big"));
          }
          if(this.hasAttribute("data-date")) {
            title += this.getAttribute("data-date");
          }
          return title;
        },
        inline: function() {
          return this.hasAttribute("inline");
        }
      });
    </script>
    {% endif %}
    {% include 'analytics.html' %}
  </body>
</html>
